<div class="policies-page">
  <div class="policies-section">
    <h2 class="policies-title">Network Policies</h2>

    <form class="policies-form" (ngSubmit)="applyPolicy()" #f="ngForm">
      <!-- Policy Type -->
      <div class="policy-form-group">
        <label class="policy-label">Policy Type</label>
        <select
          class="policy-select"
          name="policyType"
          [(ngModel)]="policyType"
          [ngClass]="{ 'is-placeholder': !policyType || (policyType==='send_email' && !selectedReason) }"
          required>
          <option class="placeholder" [ngValue]="''" disabled>Select a policy…</option>
          <option *ngFor="let t of policyTypes" [ngValue]="t.value">
            {{ t.label }} — {{
              t.value === 'send_email' && selectedReason
                ? selectedReason
                : getPlaceholderFor(t.value)
            }}
          </option>
        </select>
      </div>

      <!-- Target -->
      <div class="policy-form-group">
        <label class="policy-label">Target</label>
        <input
          class="policy-input"
          type="text"
          name="targetValue"
          [(ngModel)]="targetValue"
          [placeholder]="
            policyType === 'send_email'
              ? (selectedReason ? 'Target for ' + selectedReason : 'Choose reason first')
              : getPlaceholderFor(policyType)
          " />
      </div>

      <!-- Main Reason (solo para send_email) -->
      <div class="policy-form-group span-2" *ngIf="policyType === 'send_email'">
        <label class="policy-label">Main Reason</label>
        <select class="policy-select"
                name="reason"
                [(ngModel)]="selectedReason"
                [ngClass]="{ 'is-placeholder': !selectedReason }">
          <option class="placeholder" [ngValue]="''" disabled>Choose reason…</option>
          <option *ngFor="let reason of predefinedReasons" [value]="reason">{{ reason }}</option>
        </select>
      </div>

      <!-- Campos extra para send_email -->
      <div class="policy-form-group" *ngIf="policyType === 'send_email' && selectedReason">
        <label class="policy-label">Target to Monitor</label>
        <input class="policy-input" type="text" name="monitorTarget"
               [(ngModel)]="monitorTarget"
               [placeholder]="selectedReason.includes('IP') ? 'e.g., 192.168.1.1' : 'e.g., 8080'"/>
      </div>

      <div class="policy-form-group" *ngIf="policyType === 'send_email' && selectedReason">
        <label class="policy-label">Threshold (Packets)</label>
        <input class="policy-input" type="number" name="monitorThreshold"
               [(ngModel)]="monitorThreshold" placeholder="e.g., 10" min="1" max="10000"/>
      </div>

      <button class="apply-policy-button span-2" type="submit" [disabled]="!f.form.valid">Apply Policy</button>
      <div class="policy-result-message">{{ resultMessage }}</div>
    </form>
  </div>
</div>
